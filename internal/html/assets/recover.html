<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReMemory Recovery Tool</title>
  <style>{{STYLES}}</style>
</head>
<body>
  <!-- Toast notifications container -->
  <div id="toast-container" class="toast-container" role="alert" aria-live="polite"></div>

  <!-- QR Scanner modal -->
  <div id="qr-scanner-modal" class="qr-scanner-modal hidden">
    <div class="qr-scanner-header">
      <span data-i18n="scan_title">Scan a QR code</span>
      <button id="qr-scanner-close" class="qr-scanner-close">&times;</button>
    </div>
    <div class="qr-scanner-body">
      <video id="qr-video" autoplay playsinline></video>
      <div class="qr-scanner-overlay"></div>
    </div>
    <div class="qr-scanner-hint">
      <span data-i18n="scan_hint">Point your camera at a QR code from a friend's PDF</span>
    </div>
  </div>

  <!-- Loading overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
    <p style="margin-top: 1rem; color: #7f8c8d;" data-i18n="loading">Loading recovery module...</p>
  </div>

  <div class="container">
    <header>
      <div class="lang-toggle">
        <button data-lang="en" class="active">EN</button>
        <button data-lang="es">ES</button>
        <button data-lang="de">DE</button>
        <button data-lang="fr">FR</button>
        <button data-lang="sl">SL</button>
      </div>
      <h1 data-i18n="title">ðŸ§  ReMemory Recovery</h1>
      <p data-i18n="subtitle">Recover your encrypted files using Shamir's Secret Sharing</p>
    </header>

    <!-- Step 1: Collect Shares -->
    <div class="card">
      <h2><span class="step-number">1</span> <span data-i18n="step1_title">Collect Shares</span></h2>
      <div id="share-drop-zone" class="drop-zone">
        <p data-i18n="step1_drop">Drag & drop README.txt files here, or click to browse</p>
        <small data-i18n="step1_hint">Each README.txt contains the share for that person</small>
      </div>
      <input type="file" id="share-file-input" accept=".txt,.zip" multiple>

      <div class="paste-section">
        <button id="paste-toggle-btn" class="btn btn-secondary" type="button">
          <span>ðŸ“‹</span> <span data-i18n="paste_btn">Paste a piece or type recovery words</span>
        </button>
        <button id="scan-qr-btn" class="btn btn-secondary hidden" type="button">
          <span>ðŸ“·</span> <span data-i18n="scan_btn">Scan QR code</span>
        </button>
        <div id="paste-area" class="paste-area hidden">
          <textarea id="paste-input" placeholder="Paste share text or type your 25 recovery words here..." data-i18n-placeholder="paste_placeholder" rows="6"></textarea>
          <button id="paste-submit-btn" class="btn btn-primary" type="button" data-i18n="paste_submit">Add piece</button>
        </div>
      </div>

      <div id="shares-list" class="shares-list"></div>

      <!-- Contact list for other friends (populated via JS if personalization data exists) -->
      <div id="contact-list-section" class="contact-list-section hidden">
        <h3 data-i18n="contact_list">Contact other share holders</h3>
        <p class="hint" data-i18n="contact_list_hint">Reach out to these friends to collect their shares</p>
        <div id="contact-list" class="contact-list"></div>
      </div>

      <div id="threshold-info" class="threshold-info hidden"></div>
    </div>

    <!-- Step 2: Load Manifest -->
    <div class="card">
      <h2><span class="step-number">2</span> <span data-i18n="step2_title">Load Encrypted Manifest</span></h2>
      <div id="manifest-drop-zone" class="drop-zone">
        <p data-i18n="step2_drop">Drag & drop MANIFEST.age here, or click to browse</p>
        <small data-i18n="step2_hint">This is the encrypted file containing your secrets</small>
      </div>
      <input type="file" id="manifest-file-input" accept=".age">

      <div id="manifest-status" class="manifest-status hidden">
        <span class="icon">&#128196;</span>
        <div data-i18n="no_manifest">No manifest loaded</div>
      </div>
    </div>

    <!-- Step 3: Recover -->
    <div class="card">
      <h2><span class="step-number">3</span> <span data-i18n="step3_title">Recover Files</span></h2>
      <div id="recover-section" class="recover-section">
        <button id="recover-btn" class="btn btn-primary" disabled>
          <span>&#128275;</span> <span data-i18n="decrypt_btn">Decrypt & Recover</span>
        </button>

        <div id="progress-bar" class="progress-bar hidden">
          <div class="fill" style="width: 0%"></div>
        </div>

        <p id="status-message" class="status-message"></p>

        <div id="files-list" class="files-list"></div>

        <div id="download-actions" class="download-actions hidden">
          <button id="download-all-btn" class="btn btn-success">
            <span>&#128229;</span> <span data-i18n="download_btn">Download Archive (.tar.gz)</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>ReMemory {{VERSION}} &mdash; <span data-i18n="works_offline">Works completely offline</span></p>
    <p>
      <span data-i18n="need_help">Need help?</span>
      <a href="https://eljojo.github.io/rememory/docs.html" target="_blank">Docs</a> Â·
      <a href="{{GITHUB_URL}}" target="_blank" data-i18n="download_cli">Download CLI tool from GitHub</a>
    </p>
  </footer>

  <!-- Translations -->
  <script>
    const translations = {
      en: {
        loading: "Preparing the recovery tool...",
        title: "ðŸ§  ReMemory Recovery",
        subtitle: "A tool made for friends to unite in trying times...",
        step1_title: "Gather the pieces",
        step1_drop: "Drop the README.txt files here, or click to choose them",
        step1_hint: "Each file holds one person's piece",
        step2_title: "Add the encrypted archive",
        step2_drop: "Drop MANIFEST.age here, or click to choose it",
        step2_hint: "This is the locked archive with the memories inside",
        step3_title: "Recover the files",
        decrypt_btn: "Unlock & Recover",
        download_btn: "Download the archive (.tar.gz)",
        no_manifest: "No archive added yet",
        works_offline: "Works fully offline",
        need_help: "Need help?",
        download_cli: "Download CLI tool from GitHub",
        need_more: "Waiting for {0} more pieces",
        need_more_one: "Waiting for the last piece",
        ready: "Everything's ready",
        shares_of: "{0} of {1} pieces",
        remove: "Remove",
        loaded: "loaded",
        manifest_loaded_bundle: "loaded from bundle",
        combining: "Bringing the pieces together...",
        decrypting: "Unlocking the archive...",
        reading: "Opening the archive...",
        complete: "All done. {0} file(s) recovered.",
        error: "Error: {0}",
        duplicate: "That piece is already here (index {0})",
        no_share: "No piece found in {0}",
        invalid_share: "That piece looks invalid in {0}: {1}",
        paste_btn: "Paste a piece or type recovery words",
        paste_placeholder: "Paste share text or type your 25 recovery words here...",
        paste_submit: "Add piece",
        paste_no_share: "No piece found in the pasted text",
        your_share: "Your piece",
        your_share_loaded: "Your piece is already here",
        contact_list: "Contact the others",
        contact_list_hint: "Reach out to these friends to gather their pieces",
        contact_label: "Contact",
        pasted_content: "pasted text",
        scan_btn: "Scan QR code",
        scan_title: "Scan a QR code",
        scan_hint: "Point your camera at a QR code from a friend's PDF",
        scan_camera_error: "Could not access the camera",
        error_invalid_words_title: "Invalid recovery words",
        error_invalid_words_message: "The recovery words could not be decoded.",
        error_invalid_words_guidance: "Check the words for typos. Each word should be from the BIP39 word list printed on the recovery sheet.",
        // Error titles
        error_title: "Something went wrong",
        error_wasm_title: "Recovery tool failed to load",
        error_wasm_message: "The recovery module couldn't be loaded in your browser.",
        error_wasm_guidance: "Try refreshing the page. If this persists, try a different browser (Chrome or Firefox recommended) or use the CLI tool instead.",
        error_not_ready_title: "Not ready yet",
        error_not_ready_message: "The recovery tool is still loading.",
        error_not_ready_guidance: "Please wait a moment and try again.",
        error_invalid_share_title: "Invalid piece format",
        error_invalid_share_message: "The file \"{0}\" doesn't contain a valid piece.",
        error_invalid_share_guidance: "Make sure you're using the README.txt file from a bundle. It should contain text between 'BEGIN REMEMORY SHARE' and 'END REMEMORY SHARE' markers.",
        error_no_share_title: "No piece found",
        error_no_share_message: "The file \"{0}\" doesn't contain a recovery piece.",
        error_no_share_guidance: "Each friend received a bundle with a README.txt file containing their piece. Make sure you're uploading the correct file.",
        error_duplicate_title: "Duplicate piece",
        error_duplicate_message: "Piece #{0} is already added.",
        error_duplicate_guidance: "Each person's piece can only be used once. Try adding a different friend's piece.",
        error_file_read_title: "Couldn't read file",
        error_file_read_message: "Failed to read the file \"{0}\".",
        error_file_read_guidance: "The file might be corrupted or inaccessible. Try downloading it again or ask your friend to resend their bundle.",
        error_bundle_extract_title: "Invalid bundle",
        error_bundle_extract_message: "Couldn't extract the bundle \"{0}\".",
        error_bundle_extract_guidance: "This ZIP file doesn't appear to be a valid ReMemory bundle. Make sure you're using the original bundle.zip file that was distributed.",
        error_wrong_manifest_title: "Wrong file type",
        error_wrong_manifest_message: "The file \"{0}\" is not an encrypted archive.",
        error_wrong_manifest_guidance: "The encrypted archive should be named MANIFEST.age. You can find it inside any of the bundles that were distributed to friends.",
        error_paste_no_share_title: "No piece in pasted text",
        error_paste_no_share_message: "The pasted text doesn't contain a valid recovery piece.",
        error_paste_no_share_guidance: "Copy the entire content from your friend's README.txt file, including the 'BEGIN REMEMORY SHARE' and 'END REMEMORY SHARE' markers. You can also type or paste the 25 recovery words.",
        error_decrypt_title: "Decryption failed",
        error_decrypt_message: "The archive couldn't be decrypted with the provided pieces.",
        error_decrypt_guidance: "This usually means the pieces don't match this archive, or not enough valid pieces were provided. Make sure all pieces are from the same recovery set.",
        error_decrypt_status: "Decryption failed. Check your pieces and try again.",
        error_extract_title: "Archive extraction failed",
        error_extract_message: "The decrypted archive couldn't be opened.",
        error_extract_guidance: "The archive may be corrupted. If you have a backup of the original MANIFEST.age file, try using that instead.",
        error_extract_status: "Extraction failed. The archive may be corrupted.",
        error_recovery_title: "Recovery failed",
        error_recovery_guidance: "Check that you have the correct pieces and the right MANIFEST.age file. You can try again with different pieces if needed.",
        // Action buttons
        action_reload: "Reload page",
        action_use_cli: "Use CLI tool",
        action_try_again: "Try again",
        action_try_different_shares: "Try different pieces"
      },

      es: {
        loading: "Preparando la herramienta de recuperaciÃ³n...",
        title: "ðŸ§  Recordando Recuerdos",
        subtitle: "Cuando las cosas se ponen difÃ­ciles, los amigos se ayudan",
        step1_title: "Reunir las partes",
        step1_drop: "Arrastra los archivos README.txt aquÃ­, o haz clic para buscarlos",
        step1_hint: "Cada archivo contiene la parte de una persona",
        step2_title: "Agregar el archivo encriptado",
        step2_drop: "Arrastra MANIFEST.age aquÃ­, o haz clic para buscarlo",
        step2_hint: "Este es el archivo encriptado que guarda los recuerdos",
        step3_title: "Recuperar los archivos",
        decrypt_btn: "Desbloquear y recuperar",
        download_btn: "Descargar el archivo (.tar.gz)",
        no_manifest: "AÃºn no hay ningÃºn archivo cargado",
        works_offline: "Funciona completamente sin internet",
        need_help: "Â¿Necesitas ayuda?",
        download_cli: "Descarga la herramienta CLI desde GitHub",
        need_more: "Faltan {0} partes",
        need_more_one: "Falta la Ãºltima parte",
        ready: "Todo estÃ¡ listo",
        shares_of: "{0} de {1} partes",
        remove: "Eliminar",
        loaded: "cargado",
        manifest_loaded_bundle: "cargado del paquete",
        combining: "Uniendo las partes...",
        decrypting: "Desbloqueando el archivo...",
        reading: "Abriendo el archivo...",
        complete: "Listo. {0} archivo(s) recuperado(s).",
        error: "Error: {0}",
        duplicate: "Esa parte ya fue agregada (Ã­ndice {0})",
        no_share: "No se encontrÃ³ ninguna parte en {0}",
        invalid_share: "La parte en {0} no es vÃ¡lida: {1}",
        paste_btn: "Pegar una parte o escribir palabras de recuperaciÃ³n",
        paste_placeholder: "Pega el texto de la parte o escribe tus 25 palabras de recuperaciÃ³n aquÃ­...",
        paste_submit: "Agregar parte",
        paste_no_share: "No se encontrÃ³ ninguna parte en el texto pegado",
        your_share: "Tu parte",
        your_share_loaded: "Tu parte ya estÃ¡ cargada",
        contact_list: "Contactar a los demÃ¡s",
        contact_list_hint: "Habla con estos amigos para reunir sus partes",
        contact_label: "Contacto",
        pasted_content: "texto pegado",
        scan_btn: "Escanear QR",
        scan_title: "Escanear un cÃ³digo QR",
        scan_hint: "Apunta tu cÃ¡mara al cÃ³digo QR del PDF de tu amigo",
        scan_camera_error: "No se pudo acceder a la cÃ¡mara",
        error_invalid_words_title: "Palabras de recuperaciÃ³n invÃ¡lidas",
        error_invalid_words_message: "No se pudieron decodificar las palabras de recuperaciÃ³n.",
        error_invalid_words_guidance: "Revisa las palabras por errores de escritura. Cada palabra debe ser de la lista BIP39 impresa en la hoja de recuperaciÃ³n.",
        error_title: "Algo saliÃ³ mal",
        error_wasm_title: "Error al cargar la herramienta",
        error_wasm_message: "No se pudo cargar el mÃ³dulo de recuperaciÃ³n en tu navegador.",
        error_wasm_guidance: "Intenta refrescar la pÃ¡gina. Si el problema persiste, prueba con otro navegador (se recomienda Chrome o Firefox) o usa la herramienta CLI.",
        error_not_ready_title: "AÃºn no estÃ¡ listo",
        error_not_ready_message: "La herramienta de recuperaciÃ³n todavÃ­a estÃ¡ cargando.",
        error_not_ready_guidance: "Por favor espera un momento e intenta de nuevo.",
        error_invalid_share_title: "Formato de parte invÃ¡lido",
        error_invalid_share_message: "El archivo \"{0}\" no contiene una parte vÃ¡lida.",
        error_invalid_share_guidance: "AsegÃºrate de usar el archivo README.txt de un sobre. Debe contener texto entre los marcadores 'BEGIN REMEMORY SHARE' y 'END REMEMORY SHARE'.",
        error_no_share_title: "No se encontrÃ³ parte",
        error_no_share_message: "El archivo \"{0}\" no contiene una parte de recuperaciÃ³n.",
        error_no_share_guidance: "Cada amigo recibiÃ³ un sobre con un archivo README.txt que contiene su parte. AsegÃºrate de subir el archivo correcto.",
        error_duplicate_title: "Parte duplicada",
        error_duplicate_message: "La parte #{0} ya estÃ¡ agregada.",
        error_duplicate_guidance: "Cada parte solo puede usarse una vez. Intenta agregar la parte de otro amigo.",
        error_file_read_title: "No se pudo leer el archivo",
        error_file_read_message: "Error al leer el archivo \"{0}\".",
        error_file_read_guidance: "El archivo puede estar daÃ±ado o inaccesible. Intenta descargarlo de nuevo o pide a tu amigo que reenvÃ­e su sobre.",
        error_bundle_extract_title: "Sobre invÃ¡lido",
        error_bundle_extract_message: "No se pudo extraer el sobre \"{0}\".",
        error_bundle_extract_guidance: "Este archivo ZIP no parece ser un sobre vÃ¡lido de ReMemory. AsegÃºrate de usar el archivo bundle.zip original que se distribuyÃ³.",
        error_wrong_manifest_title: "Tipo de archivo incorrecto",
        error_wrong_manifest_message: "El archivo \"{0}\" no es un archivo encriptado.",
        error_wrong_manifest_guidance: "El archivo encriptado debe llamarse MANIFEST.age. Puedes encontrarlo dentro de cualquiera de los sobres distribuidos a los amigos.",
        error_paste_no_share_title: "No hay parte en el texto",
        error_paste_no_share_message: "El texto pegado no contiene una parte de recuperaciÃ³n vÃ¡lida.",
        error_paste_no_share_guidance: "Copia todo el contenido del archivo README.txt de tu amigo, incluyendo los marcadores 'BEGIN REMEMORY SHARE' y 'END REMEMORY SHARE'. TambiÃ©n puedes escribir o pegar las 25 palabras de recuperaciÃ³n.",
        error_decrypt_title: "Error de desencriptaciÃ³n",
        error_decrypt_message: "No se pudo desencriptar el archivo con las partes proporcionadas.",
        error_decrypt_guidance: "Esto generalmente significa que las partes no corresponden a este archivo, o no se proporcionaron suficientes partes vÃ¡lidas. AsegÃºrate de que todas las partes sean del mismo conjunto.",
        error_decrypt_status: "DesencriptaciÃ³n fallida. Revisa tus partes e intenta de nuevo.",
        error_extract_title: "Error al extraer archivo",
        error_extract_message: "No se pudo abrir el archivo desencriptado.",
        error_extract_guidance: "El archivo puede estar daÃ±ado. Si tienes una copia de seguridad del archivo MANIFEST.age original, intenta usarla.",
        error_extract_status: "ExtracciÃ³n fallida. El archivo puede estar daÃ±ado.",
        error_recovery_title: "RecuperaciÃ³n fallida",
        error_recovery_guidance: "Verifica que tengas las partes correctas y el archivo MANIFEST.age correcto. Puedes intentar de nuevo con diferentes partes si es necesario.",
        action_reload: "Recargar pÃ¡gina",
        action_use_cli: "Usar herramienta CLI",
        action_try_again: "Intentar de nuevo",
        action_try_different_shares: "Probar otras partes"
      },

      de: {
        loading: "Wiederherstellung wird vorbereitet...",
        title: "ðŸ§  ReMemory Wiederherstellung",
        subtitle: "Wenn alles schwer wirkt, kann man sich auf Freunde verlassen",
        step1_title: "Teile sammeln",
        step1_drop: "README.txt-Dateien hierher ziehen oder auswÃ¤hlen",
        step1_hint: "Jede Datei enthÃ¤lt den Teil einer Person",
        step2_title: "VerschlÃ¼sseltes Archiv hinzufÃ¼gen",
        step2_drop: "MANIFEST.age hierher ziehen oder auswÃ¤hlen",
        step2_hint: "Dieses geschÃ¼tzte Archiv enthÃ¤lt die Erinnerungen",
        step3_title: "Dateien wiederherstellen",
        decrypt_btn: "Entsperren & Wiederherstellen",
        download_btn: "Archiv herunterladen (.tar.gz)",
        no_manifest: "Noch kein Archiv geladen",
        works_offline: "Funktioniert komplett offline",
        need_help: "Brauchst du Hilfe?",
        download_cli: "CLI-Tool von GitHub herunterladen",
        need_more: "Es fehlen noch {0} Teile",
        need_more_one: "Es fehlt noch das letzte Teil",
        ready: "Alles ist bereit",
        shares_of: "{0} von {1} Teilen",
        remove: "Entfernen",
        loaded: "geladen",
        manifest_loaded_bundle: "aus Bundle geladen",
        combining: "Teile werden zusammengebracht...",
        decrypting: "Archiv wird entsperrt...",
        reading: "Archiv wird geÃ¶ffnet...",
        complete: "Fertig. {0} Datei(en) wiederhergestellt.",
        error: "Fehler: {0}",
        duplicate: "Dieser Teil ist bereits vorhanden (Index {0})",
        no_share: "Kein Teil in {0} gefunden",
        invalid_share: "Der Teil in {0} ist ungÃ¼ltig: {1}",
        paste_btn: "Teil einfÃ¼gen oder WiederherstellungswÃ¶rter eingeben",
        paste_placeholder: "Teil-Text einfÃ¼gen oder 25 WiederherstellungswÃ¶rter hier eingeben...",
        paste_submit: "Teil hinzufÃ¼gen",
        paste_no_share: "Kein Teil im eingefÃ¼gten Text gefunden",
        your_share: "Dein Teil",
        your_share_loaded: "Dein Teil ist bereits geladen",
        contact_list: "Die anderen kontaktieren",
        contact_list_hint: "Bitte diese Freunde um ihre Teile",
        contact_label: "Kontakt",
        pasted_content: "eingefÃ¼gter Text",
        scan_btn: "QR-Code scannen",
        scan_title: "QR-Code scannen",
        scan_hint: "Richte deine Kamera auf den QR-Code aus dem PDF deines Freundes",
        scan_camera_error: "Kein Zugriff auf die Kamera",
        error_invalid_words_title: "UngÃ¼ltige WiederherstellungswÃ¶rter",
        error_invalid_words_message: "Die WiederherstellungswÃ¶rter konnten nicht dekodiert werden.",
        error_invalid_words_guidance: "ÃœberprÃ¼fe die WÃ¶rter auf Tippfehler. Jedes Wort sollte aus der BIP39-Wortliste stammen, die auf dem Wiederherstellungsblatt gedruckt ist.",
        error_title: "Etwas ist schiefgelaufen",
        error_wasm_title: "Wiederherstellungstool konnte nicht geladen werden",
        error_wasm_message: "Das Wiederherstellungsmodul konnte in deinem Browser nicht geladen werden.",
        error_wasm_guidance: "Versuche die Seite neu zu laden. Falls das Problem bestehen bleibt, versuche einen anderen Browser (Chrome oder Firefox empfohlen) oder verwende das CLI-Tool.",
        error_not_ready_title: "Noch nicht bereit",
        error_not_ready_message: "Das Wiederherstellungstool wird noch geladen.",
        error_not_ready_guidance: "Bitte warte einen Moment und versuche es erneut.",
        error_invalid_share_title: "UngÃ¼ltiges Teil-Format",
        error_invalid_share_message: "Die Datei \"{0}\" enthÃ¤lt keinen gÃ¼ltigen Teil.",
        error_invalid_share_guidance: "Stelle sicher, dass du die README.txt-Datei aus einem Bundle verwendest. Sie sollte Text zwischen 'BEGIN REMEMORY SHARE' und 'END REMEMORY SHARE' Markierungen enthalten.",
        error_no_share_title: "Kein Teil gefunden",
        error_no_share_message: "Die Datei \"{0}\" enthÃ¤lt keinen Wiederherstellungsteil.",
        error_no_share_guidance: "Jeder Freund hat ein Bundle mit einer README.txt-Datei erhalten, die seinen Teil enthÃ¤lt. Stelle sicher, dass du die richtige Datei hochlÃ¤dst.",
        error_duplicate_title: "Doppelter Teil",
        error_duplicate_message: "Teil #{0} ist bereits hinzugefÃ¼gt.",
        error_duplicate_guidance: "Jeder Teil kann nur einmal verwendet werden. Versuche, den Teil eines anderen Freundes hinzuzufÃ¼gen.",
        error_file_read_title: "Datei konnte nicht gelesen werden",
        error_file_read_message: "Fehler beim Lesen der Datei \"{0}\".",
        error_file_read_guidance: "Die Datei kÃ¶nnte beschÃ¤digt oder nicht zugÃ¤nglich sein. Versuche sie erneut herunterzuladen oder bitte deinen Freund, sein Bundle erneut zu senden.",
        error_bundle_extract_title: "UngÃ¼ltiges Bundle",
        error_bundle_extract_message: "Das Bundle \"{0}\" konnte nicht extrahiert werden.",
        error_bundle_extract_guidance: "Diese ZIP-Datei scheint kein gÃ¼ltiges ReMemory-Bundle zu sein. Stelle sicher, dass du die ursprÃ¼ngliche bundle.zip-Datei verwendest.",
        error_wrong_manifest_title: "Falscher Dateityp",
        error_wrong_manifest_message: "Die Datei \"{0}\" ist kein verschlÃ¼sseltes Archiv.",
        error_wrong_manifest_guidance: "Das verschlÃ¼sselte Archiv sollte MANIFEST.age heiÃŸen. Du findest es in jedem der an Freunde verteilten Bundles.",
        error_paste_no_share_title: "Kein Teil im Text",
        error_paste_no_share_message: "Der eingefÃ¼gte Text enthÃ¤lt keinen gÃ¼ltigen Wiederherstellungsteil.",
        error_paste_no_share_guidance: "Kopiere den gesamten Inhalt der README.txt-Datei deines Freundes, einschlieÃŸlich der 'BEGIN REMEMORY SHARE' und 'END REMEMORY SHARE' Markierungen. Du kannst auch die 25 WiederherstellungswÃ¶rter eingeben oder einfÃ¼gen.",
        error_decrypt_title: "EntschlÃ¼sselung fehlgeschlagen",
        error_decrypt_message: "Das Archiv konnte mit den bereitgestellten Teilen nicht entschlÃ¼sselt werden.",
        error_decrypt_guidance: "Das bedeutet meist, dass die Teile nicht zu diesem Archiv passen oder nicht genÃ¼gend gÃ¼ltige Teile bereitgestellt wurden. Stelle sicher, dass alle Teile aus demselben Wiederherstellungsset stammen.",
        error_decrypt_status: "EntschlÃ¼sselung fehlgeschlagen. ÃœberprÃ¼fe deine Teile und versuche es erneut.",
        error_extract_title: "Archiv-Extraktion fehlgeschlagen",
        error_extract_message: "Das entschlÃ¼sselte Archiv konnte nicht geÃ¶ffnet werden.",
        error_extract_guidance: "Das Archiv kÃ¶nnte beschÃ¤digt sein. Falls du eine Sicherungskopie der Original-MANIFEST.age-Datei hast, versuche diese stattdessen zu verwenden.",
        error_extract_status: "Extraktion fehlgeschlagen. Das Archiv kÃ¶nnte beschÃ¤digt sein.",
        error_recovery_title: "Wiederherstellung fehlgeschlagen",
        error_recovery_guidance: "ÃœberprÃ¼fe, ob du die richtigen Teile und die richtige MANIFEST.age-Datei hast. Du kannst es bei Bedarf mit anderen Teilen erneut versuchen.",
        action_reload: "Seite neu laden",
        action_use_cli: "CLI-Tool verwenden",
        action_try_again: "Erneut versuchen",
        action_try_different_shares: "Andere Teile probieren"
      },

      fr: {
        loading: "PrÃ©paration de l'outil de rÃ©cupÃ©ration...",
        title: "ðŸ§  RÃ©cupÃ©ration ReMemory",
        subtitle: "Quand tout devient compliquÃ©, on peut compter sur ses amis",
        step1_title: "Rassembler les parts",
        step1_drop: "DÃ©posez les fichiers README.txt ici ou sÃ©lectionnez-les",
        step1_hint: "Chaque fichier contient la part d'une personne",
        step2_title: "Ajouter l'archive chiffrÃ©e",
        step2_drop: "DÃ©posez MANIFEST.age ici ou sÃ©lectionnez-le",
        step2_hint: "Cette archive protÃ©gÃ©e contient les souvenirs",
        step3_title: "RÃ©cupÃ©rer les fichiers",
        decrypt_btn: "DÃ©verrouiller et rÃ©cupÃ©rer",
        download_btn: "TÃ©lÃ©charger l'archive (.tar.gz)",
        no_manifest: "Aucune archive ajoutÃ©e pour le moment",
        works_offline: "Fonctionne entiÃ¨rement hors ligne",
        need_help: "Besoin d'aide ?",
        download_cli: "TÃ©lÃ©charger l'outil CLI depuis GitHub",
        need_more: "Il manque encore {0} parts",
        need_more_one: "Il manque la derniÃ¨re part",
        ready: "Tout est prÃªt",
        shares_of: "{0} sur {1} parts",
        remove: "Supprimer",
        loaded: "chargÃ©",
        manifest_loaded_bundle: "chargÃ© depuis le bundle",
        combining: "Les parts se rassemblent...",
        decrypting: "DÃ©verrouillage de l'archive...",
        reading: "Ouverture de l'archive...",
        complete: "C'est fait. {0} fichier(s) rÃ©cupÃ©rÃ©(s).",
        error: "Erreur : {0}",
        duplicate: "Cette part est dÃ©jÃ  prÃ©sente (index {0})",
        no_share: "Aucune part trouvÃ©e dans {0}",
        invalid_share: "La part dans {0} est invalide : {1}",
        paste_btn: "Coller une part ou saisir les mots de rÃ©cupÃ©ration",
        paste_placeholder: "Collez le texte de la part ou saisissez vos 25 mots de rÃ©cupÃ©ration ici...",
        paste_submit: "Ajouter la part",
        paste_no_share: "Aucune part trouvÃ©e dans le texte collÃ©",
        your_share: "Votre part",
        your_share_loaded: "Votre part est dÃ©jÃ  chargÃ©e",
        contact_list: "Contacter les autres",
        contact_list_hint: "Contactez ces amis pour rÃ©unir leurs parts",
        contact_label: "Contact",
        pasted_content: "texte collÃ©",
        scan_btn: "Scanner QR",
        scan_title: "Scanner un code QR",
        scan_hint: "Dirigez votre camÃ©ra vers le QR code du PDF de votre ami",
        scan_camera_error: "Impossible d'accÃ©der Ã  la camÃ©ra",
        error_invalid_words_title: "Mots de rÃ©cupÃ©ration invalides",
        error_invalid_words_message: "Les mots de rÃ©cupÃ©ration n'ont pas pu Ãªtre dÃ©codÃ©s.",
        error_invalid_words_guidance: "VÃ©rifiez les mots pour les fautes de frappe. Chaque mot doit figurer dans la liste BIP39 imprimÃ©e sur la feuille de rÃ©cupÃ©ration.",
        error_title: "Une erreur s'est produite",
        error_wasm_title: "Ã‰chec du chargement de l'outil",
        error_wasm_message: "Le module de rÃ©cupÃ©ration n'a pas pu Ãªtre chargÃ© dans votre navigateur.",
        error_wasm_guidance: "Essayez de rafraÃ®chir la page. Si le problÃ¨me persiste, essayez un autre navigateur (Chrome ou Firefox recommandÃ©) ou utilisez l'outil CLI.",
        error_not_ready_title: "Pas encore prÃªt",
        error_not_ready_message: "L'outil de rÃ©cupÃ©ration est encore en cours de chargement.",
        error_not_ready_guidance: "Veuillez patienter un moment et rÃ©essayer.",
        error_invalid_share_title: "Format de part invalide",
        error_invalid_share_message: "Le fichier \"{0}\" ne contient pas une part valide.",
        error_invalid_share_guidance: "Assurez-vous d'utiliser le fichier README.txt d'une enveloppe. Il doit contenir du texte entre les marqueurs 'BEGIN REMEMORY SHARE' et 'END REMEMORY SHARE'.",
        error_no_share_title: "Aucune part trouvÃ©e",
        error_no_share_message: "Le fichier \"{0}\" ne contient pas de part de rÃ©cupÃ©ration.",
        error_no_share_guidance: "Chaque ami a reÃ§u une enveloppe avec un fichier README.txt contenant sa part. Assurez-vous de tÃ©lÃ©charger le bon fichier.",
        error_duplicate_title: "Part en double",
        error_duplicate_message: "La part #{0} est dÃ©jÃ  ajoutÃ©e.",
        error_duplicate_guidance: "Chaque part ne peut Ãªtre utilisÃ©e qu'une seule fois. Essayez d'ajouter la part d'un autre ami.",
        error_file_read_title: "Impossible de lire le fichier",
        error_file_read_message: "Ã‰chec de la lecture du fichier \"{0}\".",
        error_file_read_guidance: "Le fichier peut Ãªtre corrompu ou inaccessible. Essayez de le tÃ©lÃ©charger Ã  nouveau ou demandez Ã  votre ami de renvoyer son enveloppe.",
        error_bundle_extract_title: "Enveloppe invalide",
        error_bundle_extract_message: "Impossible d'extraire l'enveloppe \"{0}\".",
        error_bundle_extract_guidance: "Ce fichier ZIP ne semble pas Ãªtre une enveloppe ReMemory valide. Assurez-vous d'utiliser le fichier bundle.zip original qui a Ã©tÃ© distribuÃ©.",
        error_wrong_manifest_title: "Mauvais type de fichier",
        error_wrong_manifest_message: "Le fichier \"{0}\" n'est pas une archive chiffrÃ©e.",
        error_wrong_manifest_guidance: "L'archive chiffrÃ©e doit s'appeler MANIFEST.age. Vous pouvez la trouver dans n'importe quelle enveloppe distribuÃ©e aux amis.",
        error_paste_no_share_title: "Aucune part dans le texte",
        error_paste_no_share_message: "Le texte collÃ© ne contient pas de part de rÃ©cupÃ©ration valide.",
        error_paste_no_share_guidance: "Copiez tout le contenu du fichier README.txt de votre ami, y compris les marqueurs 'BEGIN REMEMORY SHARE' et 'END REMEMORY SHARE'. Vous pouvez aussi saisir ou coller les 25 mots de rÃ©cupÃ©ration.",
        error_decrypt_title: "Ã‰chec du dÃ©chiffrement",
        error_decrypt_message: "L'archive n'a pas pu Ãªtre dÃ©chiffrÃ©e avec les parts fournies.",
        error_decrypt_guidance: "Cela signifie gÃ©nÃ©ralement que les parts ne correspondent pas Ã  cette archive, ou que le nombre de parts valides fourni est insuffisant. Assurez-vous que toutes les parts proviennent du mÃªme ensemble.",
        error_decrypt_status: "Ã‰chec du dÃ©chiffrement. VÃ©rifiez vos parts et rÃ©essayez.",
        error_extract_title: "Ã‰chec de l'extraction",
        error_extract_message: "L'archive dÃ©chiffrÃ©e n'a pas pu Ãªtre ouverte.",
        error_extract_guidance: "L'archive peut Ãªtre corrompue. Si vous avez une sauvegarde du fichier MANIFEST.age original, essayez de l'utiliser Ã  la place.",
        error_extract_status: "Ã‰chec de l'extraction. L'archive peut Ãªtre corrompue.",
        error_recovery_title: "Ã‰chec de la rÃ©cupÃ©ration",
        error_recovery_guidance: "VÃ©rifiez que vous avez les bonnes parts et le bon fichier MANIFEST.age. Vous pouvez rÃ©essayer avec diffÃ©rentes parts si nÃ©cessaire.",
        action_reload: "RafraÃ®chir la page",
        action_use_cli: "Utiliser l'outil CLI",
        action_try_again: "RÃ©essayer",
        action_try_different_shares: "Essayer d'autres parts"
      },
      sl: {
        loading: "Pripravljenje orodja za obnovitev ...",
        title: "ðŸ§  ReMemory Recovery",
        subtitle: "Orodje narejeno za prijatelje, da se zdruÅ¾ijo v teÅ¾kih Äasih ...",
        step1_title: "Zberite sveÅ¾nje",
        step1_drop: "Spustite datoteke README.txt tukaj ali kliknite za izbiro datotek iz naprave",
        step1_hint: "Vsaka datoteka vsebuje sveÅ¾enj enega prijatelja",
        step2_title: "Dodajte Å¡ifriran arhiv",
        step2_drop: "Spustite MANIFEST.age tukaj ali kliknite za izbiro datotek iz naprave",
        step2_hint: "To je zaklenjen arhiv znotraj katere so spomini",
        step3_title: "Obnovite datoteke",
        decrypt_btn: "Odkleni & Obnovi",
        download_btn: "Prenesi arhiv (.tar.gz)",
        no_manifest: "Arhiv Å¡e ni dodan",
        works_offline: "Deluje popolnoma brez povezave",
        need_help: "Potrebujete pomoÄ?",
        download_cli: "Prenesite CLI orodje z GitHub",
        need_more: "Potrebno je dodati Å¡e {0} delov",
        need_more_one: "Potrebno je dodati Å¡e zadnji del",
        ready: "Vse je pripravljeno",
        shares_of: "{0} od {1} delov",
        remove: "Odstrani",
        loaded: "naloÅ¾eno",
        manifest_loaded_bundle: "naloÅ¾eno iz sveÅ¾nja",
        combining: "Sestavljanje sveÅ¾njev skupaj ...",
        decrypting: "Odklepanje arhiva ...",
        reading: "Odpiranje arhiva ...",
        complete: "KonÄano. Obnovljenih datotek: {0}.",
        error: "Napaka: {0}",
        duplicate: "Ta sveÅ¾enj je Å¾e tukaj (indeks {0})",
        no_share: "SveÅ¾enj ni bil najden v {0}",
        invalid_share: "Ta sveÅ¾enj je videti neveljaven v {0}: {1}",
        paste_btn: "Prilepite sveÅ¾enj ali vnesite besede za obnovitev",
        paste_placeholder: "Prilepite besedilo sveÅ¾nja ali vnesite 25 besed za obnovitev tukaj...",
        paste_submit: "Dodaj sveÅ¾enj",
        paste_no_share: "V prilepljenem besedilu ni bilo najdenega sveÅ¾nja",
        your_share: "VaÅ¡ sveÅ¾enj",
        your_share_loaded: "VaÅ¡ sveÅ¾enj je Å¾e tukaj",
        contact_list: "Kontaktirajte druge",
        contact_list_hint: "Obrnite se na te prijatelje, da zberete njihove sveÅ¾nje",
        contact_label: "Kontakt",
        pasted_content: "prilepljeno besedilo",
        scan_btn: "Skeniraj QR kodo",
        scan_title: "Skeniraj QR kodo",
        scan_hint: "Usmerite kamero na QR kodo s prijateljevega PDF-ja",
        scan_camera_error: "Ni mogoÄe dostopati do kamere",
        error_invalid_words_title: "Neveljavne besede za obnovitev",
        error_invalid_words_message: "Besed za obnovitev ni bilo mogoÄe dekodirati.",
        error_invalid_words_guidance: "Preverite besede za tipkarske napake. Vsaka beseda mora biti s seznama BIP39, natisnjenega na listu za obnovitev.",
        // Error titles
        error_title: "Nekaj je Å¡lo narobe",
        error_wasm_title: "Orodje za obnovitev ni uspelo naloÅ¾iti",
        error_wasm_message: "Modula za obnovitev ni bilo mogoÄe naloÅ¾iti v vaÅ¡em brskalniku.",
        error_wasm_guidance: "Poskusite osveÅ¾iti stran. ÄŒe se teÅ¾ava ponavlja, poskusite z drugim brskalnikom (priporoÄamo Chrome ali Firefox) ali uporabite orodje CLI.",
        error_not_ready_title: "Å e ni pripravljeno",
        error_not_ready_message: "Orodje za obnovitev se Å¡e nalaga.",
        error_not_ready_guidance: "Prosim, poÄakajte trenutek in poskusite znova.",
        error_invalid_share_title: "Neveljavna oblika sveÅ¾nja",
        error_invalid_share_message: "Datoteka \"{0}\" ne vsebuje veljavnega sveÅ¾nja.",
        error_invalid_share_guidance: "Poskrbite, da uporabljate datoteko README.txt iz sveÅ¾nja. Vsebovati mora besedilo med oznakama 'BEGIN REMEMORY SHARE' in 'END REMEMORY SHARE'.",
        error_no_share_title: "SveÅ¾enj ni bil najden",
        error_no_share_message: "Datoteka \"{0}\" ne vsebuje sveÅ¾nja za obnovitev.",
        error_no_share_guidance: "Vsak prijatelj je prejel sveÅ¾enj z datoteko README.txt, ki vsebuje njihov sveÅ¾enj. PrepriÄajte se, da nalagate pravilno datoteko.",
        error_duplicate_title: "Podvojen sveÅ¾enj",
        error_duplicate_message: "SveÅ¾enj #{0} je Å¾e dodan.",
        error_duplicate_guidance: "Vsak sveÅ¾enj lahko uporabite samo enkrat. Poskusite dodati sveÅ¾enj drugega prijatelja.",
        error_file_read_title: "Ni bilo mogoÄe prebrati datoteke",
        error_file_read_message: "Ni bilo mogoÄe prebrati datoteke \"{0}\".",
        error_file_read_guidance: "Datoteka je morda poÅ¡kodovana ali nedostopna. Poskusite jo znova prenesti ali prosite prijatelja, naj vam poÅ¡lje sveÅ¾enj Å¡e enkrat.",
        error_bundle_extract_title: "Neveljaven sveÅ¾enj",
        error_bundle_extract_message: "Ni bilo mogoÄe izvleÄi sveÅ¾nja \"{0}\".",
        error_bundle_extract_guidance: "Ta ZIP datoteka ne izgleda kot veljaven ReMemory sveÅ¾enj. PrepriÄajte se, da uporabljate izvirno datoteko bundle.zip, ki je bila razdeljena.",
        error_wrong_manifest_title: "NapaÄna vrsta datoteke",
        error_wrong_manifest_message: "Datoteka \"{0}\" ni Å¡ifriran arhiv.",
        error_wrong_manifest_guidance: "Å ifriran arhiv mora biti poimenovan MANIFEST.age. Najdete ga lahko v katerem koli od sveÅ¾njev, ki so bili razdeljeni prijateljem.",
        error_paste_no_share_title: "V prilepljenem besedilu ni bilo najdenega sveÅ¾nja",
        error_paste_no_share_message: "Prilepljeno besedilo ne vsebuje veljavnega sveÅ¾nja za obnovitev.",
        error_paste_no_share_guidance: "Kopirajte celotno vsebino iz datoteke README.txt vaÅ¡ega prijatelja, vkljuÄno z oznakami 'BEGIN REMEMORY SHARE' in 'END REMEMORY SHARE'. Lahko tudi vnesete ali prilepite 25 besed za obnovitev.",
        error_decrypt_title: "DeÅ¡ifriranje ni uspelo",
        error_decrypt_message: "Arhiva ni bilo mogoÄe deÅ¡ifrirati z danimi sveÅ¾nji.",
        error_decrypt_guidance: "To obiÄajno pomeni, da sveÅ¾nji ne ustrezajo temu arhivu ali pa da ni bilo zagotovljenih dovolj veljavnih sveÅ¾njev. PrepriÄajte se, da so vsi sveÅ¾nji iz istega nabora za obnovitev.",
        error_decrypt_status: "DeÅ¡ifriranje ni uspelo. Preverite svoje sveÅ¾nje in poskusite znova.",
        error_extract_title: "IzvleÄek arhiva ni uspel",
        error_extract_message: "DeÅ¡ifriranega arhiva ni bilo mogoÄe odpreti.",
        error_extract_guidance: "Arhiv je morda poÅ¡kodovan. ÄŒe imate varnostno kopijo izvirne datoteke MANIFEST.age, poskusite uporabiti to.",
        error_extract_status: "IzvleÄek ni uspel. Arhiv je morda poÅ¡kodovan.",
        error_recovery_title: "Obnovitev ni uspela",
        error_recovery_guidance: "Preverite, ali imate pravilne sveÅ¾nje in pravo datoteko MANIFEST.age. Po potrebi lahko poskusite znova z razliÄnimi sveÅ¾nji.",
        // Action buttons
        action_reload: "OsveÅ¾i stran",
        action_use_cli: "Uporabi CLI orodje",
        action_try_again: "Poskusi znova",
        action_try_different_shares: "Poskusi razliÄne sveÅ¾nje"
      }
    };

    let currentLang = 'en';

    function t(key, ...args) {
      let text = translations[currentLang][key] || translations['en'][key] || key;
      args.forEach((arg, i) => {
        text = text.replace(`{${i}}`, arg);
      });
      return text;
    }

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('rememory-lang', lang);

      // Update toggle buttons
      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      // Update all translatable elements
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        el.textContent = t(key);
      });

      // Update placeholder attributes
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        el.placeholder = t(key);
      });

      // Update page title
      document.title = t('title');
    }

    // Set initial language immediately (before app.js runs)
    (function() {
      const saved = localStorage.getItem('rememory-lang');
      const browserLang = navigator.language.split('-')[0];
      currentLang = saved || (['es', 'de', 'fr', 'sl'].includes(browserLang) ? browserLang : 'en');
    })();

    // Initialize language toggle buttons after DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      setLanguage(currentLang);

      // Add click handlers
      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        btn.addEventListener('click', () => {
          setLanguage(btn.dataset.lang);
          // Re-render dynamic content when language changes
          if (typeof window.rememoryUpdateUI === 'function') {
            window.rememoryUpdateUI();
          }
        });
      });
    });
  </script>

  <!-- Go WASM runtime -->
  <script>{{WASM_EXEC}}</script>

  <!-- Embedded WASM binary (base64) -->
  <script>
    window.WASM_BINARY = "{{WASM_BASE64}}";
  </script>

  <!-- Personalization data (embedded for this specific friend) -->
  <script>
    window.PERSONALIZATION = {{PERSONALIZATION_DATA}};
  </script>

  <!-- Application logic (must come after WASM_BINARY and PERSONALIZATION) -->
  <!-- App.js handles WASM loading with gzip decompression -->
  <script>{{APP_JS}}</script>
</body>
</html>
