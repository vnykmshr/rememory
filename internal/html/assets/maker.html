<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß† ReMemory - Create Recovery Bundles</title>
  <style>{{STYLES}}</style>
  <style>
    /* Maker-specific styles */

    /* Friend list */
    .friend-entry {
      display: grid;
      grid-template-columns: auto 1fr 1fr auto auto;
      gap: 0.5rem;
      align-items: end;
      padding: 0.75rem;
      background: #f8f9fa;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    .friend-entry .field {
      display: flex;
      flex-direction: column;
    }
    .friend-entry label {
      font-size: 0.75rem;
      color: #6c757d;
      margin-bottom: 0.25rem;
    }
    .friend-entry input {
      padding: 0.375rem 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.875rem;
    }
    .friend-entry .remove-btn {
      padding: 0.375rem 0.5rem;
      background: transparent;
      color: #adb5bd;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      transition: all 0.15s;
    }
    .friend-entry .remove-btn:hover {
      background: #f8d7da;
      color: #dc3545;
      border-color: #dc3545;
    }
    .friend-entry .friend-number {
      font-weight: bold;
      color: #495057;
      display: flex;
      align-items: center;
      padding-bottom: 0.375rem;
      min-width: 2rem;
    }

    @media (max-width: 768px) {
      .friend-entry {
        grid-template-columns: auto 1fr 1fr auto;
      }
      .friend-entry .field:nth-child(4) {
        grid-column: 2 / 4;
      }
      .friend-entry .remove-btn {
        grid-row: 1;
        grid-column: 4;
      }
    }

    /* Threshold selector */
    .threshold-selector {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
      padding: 1rem;
      background: #e8f4fc;
      border-radius: 4px;
    }
    .threshold-selector select {
      padding: 0.375rem 0.5rem;
      border: 1px solid #3498db;
      border-radius: 4px;
      font-size: 1rem;
      background: white;
    }

    /* Files preview */
    .files-preview {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f8f9fa;
    }
    .files-preview .file-item {
      display: flex;
      align-items: center;
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid #eee;
    }
    .files-preview .file-item:last-child {
      border-bottom: none;
    }
    .files-preview .file-item .icon {
      margin-right: 0.5rem;
      color: #6c757d;
    }
    .files-preview .file-item .name {
      flex: 1;
      font-family: monospace;
      font-size: 0.875rem;
    }
    .files-preview .file-item .size {
      color: #6c757d;
      font-size: 0.75rem;
    }
    .files-preview .file-item .file-remove-btn {
      padding: 0.25rem 0.5rem;
      background: transparent;
      color: #adb5bd;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      line-height: 1;
      margin-left: 0.5rem;
      transition: all 0.15s;
    }
    .files-preview .file-item .file-remove-btn:hover {
      background: #f8d7da;
      color: #dc3545;
      border-color: #dc3545;
    }
    .files-summary {
      padding: 0.5rem 0.75rem;
      background: #e8f4fc;
      border-radius: 0 0 4px 4px;
      font-size: 0.875rem;
      color: #495057;
    }

    /* Bundle list */
    .bundle-item {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      background: #f8f9fa;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    .bundle-item.ready {
      background: #d4edda;
    }
    .bundle-item .icon {
      margin-right: 0.75rem;
      font-size: 1.5rem;
    }
    .bundle-item .details {
      flex: 1;
    }
    .bundle-item .name {
      font-weight: 500;
    }
    .bundle-item .meta {
      font-size: 0.875rem;
      color: #6c757d;
    }
    .bundle-item .download-btn {
      padding: 0.375rem 0.75rem;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
    }
    .bundle-item .download-btn:hover {
      background: #218838;
    }

    /* Maker nav */
    .maker-nav {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .maker-nav .logo {
      font-size: 1.25rem;
      font-weight: bold;
      color: #2c3e50;
      text-decoration: none;
    }
    .maker-nav .nav-links {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    .maker-nav .nav-links a {
      color: #3498db;
      text-decoration: none;
      font-size: 0.95rem;
    }
    .maker-nav .nav-links a:hover {
      text-decoration: underline;
    }
    .maker-nav .lang-toggle {
      position: static;
      margin-left: auto;
    }

    /* Card header with title and anonymous toggle */
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .card-header h2 {
      margin-bottom: 0;
    }
    .anonymous-toggle {
      font-size: 0.8rem;
      color: #6c757d;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    .anonymous-toggle input {
      width: 14px;
      height: 14px;
      cursor: pointer;
    }
    .anonymous-toggle:hover {
      color: #495057;
    }

    /* Anonymous mode shares input */
    .shares-input {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    .shares-input label {
      font-size: 0.875rem;
      color: #495057;
    }
    .shares-input input {
      width: 60px;
      padding: 0.375rem 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      text-align: center;
    }

    /* Maker intro */
    .maker-intro {
      background: white;
      border-radius: 8px;
      padding: 1.5rem 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
    }
    .maker-intro h1 {
      font-size: 1.5rem;
      color: #2c3e50;
      margin-bottom: 0.25rem;
    }
    .maker-intro .subtitle {
      color: #7f8c8d;
      margin-bottom: 1rem;
    }
    .maker-intro .summary {
      color: #495057;
      line-height: 1.7;
      margin-bottom: 1rem;
    }
    .maker-intro details {
      border-top: 1px solid #eee;
      padding-top: 1rem;
    }
    .maker-intro summary {
      cursor: pointer;
      color: #3498db;
      font-size: 0.95rem;
    }
    .maker-intro summary:hover {
      text-decoration: underline;
    }
    .maker-intro .details-content {
      margin-top: 1rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 4px;
    }
    .maker-intro .details-content h3 {
      font-size: 1rem;
      color: #2c3e50;
      margin: 1rem 0 0.5rem;
    }
    .maker-intro .details-content h3:first-child {
      margin-top: 0;
    }
    .maker-intro .details-content ul {
      margin: 0;
      padding-left: 1.25rem;
      color: #6c757d;
      font-size: 0.95rem;
    }
    .maker-intro .details-content li {
      margin: 0.25rem 0;
    }

    footer .version {
      font-size: 0.75rem;
      color: #bdc3c7;
      margin-top: 0.25rem;
    }

    @media (max-width: 600px) {
      .maker-nav {
        flex-direction: column;
        text-align: center;
      }
      .maker-nav .lang-toggle {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Toast notifications container -->
  <div id="toast-container" class="toast-container" role="alert" aria-live="polite"></div>

  <!-- Loading overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
    <p style="margin-top: 1rem; color: #7f8c8d;" data-i18n="loading">Loading bundle creator...</p>
  </div>

  <div class="container">
    <nav class="maker-nav">
      <a href="index.html" class="logo">üß† ReMemory</a>
      <div class="nav-links">
        <a href="index.html">About</a>
        <a href="docs.html">Guide</a>
        <a href="https://github.com/eljojo/rememory" target="_blank">GitHub</a>
      </div>
      <div class="lang-toggle">
        <button data-lang="en" class="active">EN</button>
        <button data-lang="es">ES</button>
        <button data-lang="de">DE</button>
        <button data-lang="fr">FR</button>
        <button data-lang="sl">SL</button>
      </div>
    </nav>

    <div class="maker-intro">
      <h1 data-i18n="page_title">Create Bundles</h1>
      <p class="subtitle" data-i18n="subtitle">Make sure your important files are never lost.</p>
      <p data-i18n="page_description" class="summary">
        Add files, choose friends, set a threshold. Each friend gets a bundle they can use to help recover your files later.
        Everything runs locally‚Äîyour files never leave your browser.
      </p>

      <details>
        <summary>How does this work?</summary>
        <div class="details-content">
          <h3>Creating bundles (this page)</h3>
          <ul>
            <li>Add your sensitive files and choose trusted friends</li>
            <li>Set a threshold (e.g., "3 of 5 friends needed")</li>
            <li>Generate a unique bundle for each friend</li>
            <li>Send each friend their bundle (email, USB, etc.)</li>
          </ul>

          <h3>Recovering files (when needed)</h3>
          <ul>
            <li>Friends open their bundle's <code>recover.html</code> in any browser</li>
            <li>They combine their shares (threshold number required)</li>
            <li>Files are decrypted and recovered‚Äîno server needed</li>
          </ul>

          <h3>Security notes</h3>
          <ul>
            <li>Everything runs locally in your browser‚Äîno data leaves your device</li>
            <li>You can save this page to your computer and use it offline</li>
            <li>Files are encrypted with <a href="https://github.com/FiloSottile/age" target="_blank">age</a></li>
            <li>Open source (Apache-2.0)</li>
          </ul>
        </div>
      </details>
    </div>

    <!-- Step 1: Friends -->
    <div class="card">
      <div class="card-header">
        <h2><span class="step-number">1</span> <span data-i18n="step1_title">Friends</span></h2>
        <label class="anonymous-toggle">
          <input type="checkbox" id="anonymous-mode">
          <span data-i18n="anonymous_label">Anonymous</span>
        </label>
      </div>
      <p class="hint" id="friends-hint" data-i18n="friends_hint">Add at least 2 friends who will hold pieces of your recovery key</p>

      <!-- Anonymous mode: shares input -->
      <div id="shares-input" class="shares-input hidden">
        <label for="num-shares" data-i18n="num_shares_label">Number of shares:</label>
        <input type="number" id="num-shares" min="2" max="20" value="5">
      </div>

      <!-- Normal mode: friends list -->
      <div id="friends-section">
        <div id="friends-list"></div>

        <button id="add-friend-btn" class="btn btn-secondary" type="button">
          <span>+</span> <span data-i18n="add_friend">Add Friend</span>
        </button>
      </div>

      <div class="threshold-selector">
        <label for="threshold-select" data-i18n="threshold_label">Threshold:</label>
        <select id="threshold-select"></select>
        <span data-i18n="threshold_desc">friends needed to recover</span>
      </div>

      <details id="import-section" class="import-section">
        <summary data-i18n="import_summary">Import contacts from existing project.yml</summary>
        <textarea id="yaml-import" placeholder="Paste your project.yml content here..." data-i18n-placeholder="import_placeholder"></textarea>
        <button id="import-btn" class="btn btn-secondary" type="button" data-i18n="import_btn">Import Contacts</button>
      </details>

      <div id="friends-validation" class="validation-error hidden"></div>
    </div>

    <!-- Step 2: Manifest Files -->
    <div class="card">
      <h2><span class="step-number">2</span> <span data-i18n="step2_title">Files to Protect</span></h2>

      <div id="files-drop-zone" class="drop-zone">
        <p data-i18n="files_drop">Drag & drop a folder here, or click to select files</p>
        <small data-i18n="files_hint">These files will be encrypted and split among your friends</small>
      </div>
      <input type="file" id="files-input" multiple>
      <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;">

      <div id="files-preview" class="files-preview hidden"></div>
      <div id="files-summary" class="files-summary hidden"></div>
    </div>

    <!-- Step 3: Generate -->
    <div class="card">
      <h2><span class="step-number">3</span> <span data-i18n="step3_title">Generate Bundles</span></h2>

      <button id="generate-btn" class="btn btn-primary" disabled>
        <span data-i18n="generate_btn">Generate Bundles</span>
      </button>

      <div id="progress-bar" class="progress-bar hidden">
        <div class="fill" style="width: 0%"></div>
      </div>

      <p id="status-message" class="status-message"></p>

      <div id="bundles-list" class="hidden"></div>

      <div id="download-all-section" class="download-actions hidden">
        <button id="download-all-btn" class="btn btn-success">
          <span data-i18n="download_all_btn">Download All Bundles</span>
        </button>
        <button id="download-yaml-btn" class="btn btn-secondary">
          <span data-i18n="download_yaml_btn">Save project.yml</span>
        </button>
      </div>
    </div>
  </div>

  <footer>
    <p><span data-i18n="works_offline">Works completely offline</span></p>
    <p class="version">{{VERSION}}</p>
  </footer>

  <!-- Translations -->
  <script>
    const translations = {
      en: {
        loading: "Preparing the bundle creator...",
        title: "üß† ReMemory - Create Bundles",
        page_title: "Create Bundles",
        page_description: "Add files, choose friends, set a threshold. Each friend gets a bundle they can use to help recover your files later. Everything runs locally‚Äîyour files never leave your browser.",
        subtitle: "Make sure your important files are never lost.",
        step1_title: "Friends",
        friends_hint: "Add at least 2 friends who will each hold a piece of your recovery key",
        anonymous_label: "Anonymous",
        anonymous_hint: "Shareholders won't know each other",
        num_shares_label: "Number of shares:",
        add_friend: "Add Friend",
        threshold_label: "Threshold:",
        threshold_desc: "friends required to recover",
        name_label: "Name",
        email_label: "Email",
        phone_label: "Phone (optional)",
        import_summary: "Import contacts from an existing project.yml",
        import_placeholder: "Paste your project.yml content here...",
        import_btn: "Import Contacts",
        step2_title: "Files to Protect",
        files_drop: "Drag & drop a folder here, or click to select files",
        files_hint: "These files will be encrypted and distributed among your friends",
        files_summary: "{0} file(s), {1} total",
        step3_title: "Generate Bundles",
        generate_btn: "Generate Bundles",
        download_all_btn: "Download All Bundles",
        download_yaml_btn: "Save project.yml",
        works_offline: "Works completely offline",
        need_help: "Need help?",
        download_cli: "Download the CLI tool from GitHub",
        generating: "Generating bundles...",
        archiving: "Archiving files...",
        encrypting: "Encrypting archive...",
        splitting: "Splitting secret...",
        creating_bundle: "Creating bundle for {0}...",
        complete: "All bundles created successfully!",
        error: "Error: {0}",
        validation_min_friends: "You need at least 2 friends",
        validation_friend_name: "Friend {0}: name is required",
        validation_friend_email: "Friend {0} ({1}): email is required",
        validation_no_files: "Please select at least one file",
        download: "Download",
        bundle_for: "Bundle for {0}",
        import_success: "Imported {0} contacts",
        import_error: "Failed to parse YAML: {0}",
        // Error messages with guidance
        error_title: "Something went wrong",
        error_not_ready_title: "Not ready yet",
        error_not_ready_message: "The bundle creator is still loading.",
        error_not_ready_guidance: "Please wait a moment and try again.",
        error_import_title: "Import failed",
        error_import_guidance: "Make sure the YAML format is correct. Check for proper indentation and that all required fields (name, email) are present.",
        error_min_friends_title: "Minimum friends required",
        error_min_friends_guidance: "Recovery requires at least 2 friends to split the secret. Add more friends to continue.",
        error_generate_title: "Bundle creation failed",
        error_generate_guidance: "Check that all friends have names and emails, and that you've selected at least one file. Then try again.",
        action_try_again: "Try again",
        validation_title: "Some fields need attention",
        validation_message: "Please fill in the highlighted fields before generating bundles.",
        validation_guidance: "Required fields are marked with an asterisk (*). Make sure each friend has a name and email, and you've added at least one file."
      },

      es: {
        loading: "Preparando el creador de sobres...",
        title: "üß† ReMemory - Guarda lo Importante",
        page_title: "Crear Sobres",
        page_description: "A√±ade archivos, elige amigos y define un umbral. Cada amigo recibe una parte que puede usar para ayudar a recuperar tus archivos m√°s adelante. Todo funciona de forma local: tus archivos nunca salen de tu navegador.",
        subtitle: "Quien tiene un amigo, tiene un tesoro.",

        step1_title: "Amigos",
        friends_hint: "Agrega al menos 2 amigos que guardar√°n partes de tu clave de recuperaci√≥n",
        anonymous_label: "An√≥nimo",
        anonymous_hint: "Los participantes no sabr√°n qui√©nes son los dem√°s",
        num_shares_label: "N√∫mero de partes:",
        add_friend: "Agregar amigo",

        threshold_label: "Umbral:",
        threshold_desc: "amigos necesarios para recuperar",

        name_label: "Nombre",
        email_label: "Correo",
        phone_label: "Tel√©fono (opcional)",

        import_summary: "Importar contactos desde un project.yml existente",
        import_placeholder: "Pega aqu√≠ el contenido de tu project.yml...",
        import_btn: "Importar contactos",

        step2_title: "Archivos a proteger",
        files_drop: "Arrastra una carpeta aqu√≠ o haz clic para seleccionar archivos",
        files_hint: "Estos archivos ser√°n cifrados y repartidos entre tus amigos",
        files_summary: "{0} archivo(s), {1} en total",

        step3_title: "Generar sobres",
        generate_btn: "Generar sobres",
        download_all_btn: "Descargar todos los sobres",
        download_yaml_btn: "Guardar project.yml",

        works_offline: "Funciona completamente sin conexi√≥n",
        need_help: "¬øNecesitas ayuda?",
        download_cli: "Descarga la herramienta CLI desde GitHub",

        generating: "Generando sobres...",
        archiving: "Preparando archivos...",
        encrypting: "Cifrando archivos...",
        splitting: "Dividiendo la clave...",
        creating_bundle: "Creando sobre para {0}...",

        complete: "¬°Todos los sobres fueron creados con √©xito!",
        error: "Error: {0}",

        validation_min_friends: "Necesitas al menos 2 amigos",
        validation_friend_name: "Amigo {0}: el nombre es obligatorio",
        validation_friend_email: "Amigo {0} ({1}): el correo es obligatorio",
        validation_no_files: "Por favor selecciona al menos un archivo",

        download: "Descargar",
        bundle_for: "Sobre para {0}",

        import_success: "Se importaron {0} contactos",
        import_error: "Error al leer el YAML: {0}",
        error_title: "Algo sali√≥ mal",
        error_not_ready_title: "A√∫n no est√° listo",
        error_not_ready_message: "El creador de sobres todav√≠a est√° cargando.",
        error_not_ready_guidance: "Por favor espera un momento e intenta de nuevo.",
        error_import_title: "Error en la importaci√≥n",
        error_import_guidance: "Aseg√∫rate de que el formato YAML sea correcto. Verifica la indentaci√≥n y que todos los campos requeridos (nombre, correo) est√©n presentes.",
        error_min_friends_title: "M√≠nimo de amigos requerido",
        error_min_friends_guidance: "La recuperaci√≥n requiere al menos 2 amigos para dividir el secreto. Agrega m√°s amigos para continuar.",
        error_generate_title: "Error al crear sobres",
        error_generate_guidance: "Verifica que todos los amigos tengan nombre y correo, y que hayas seleccionado al menos un archivo. Luego intenta de nuevo.",
        action_try_again: "Intentar de nuevo",
        validation_title: "Algunos campos necesitan atenci√≥n",
        validation_message: "Por favor completa los campos resaltados antes de generar los sobres.",
        validation_guidance: "Los campos obligatorios est√°n marcados con un asterisco (*). Aseg√∫rate de que cada amigo tenga nombre y correo, y de haber agregado al menos un archivo."
      },

      de: {
        loading: "Umschl√§ge werden vorbereitet...",
        title: "üß† ReMemory ‚Äî Bewahre das Wichtige",
        page_title: "Umschl√§ge erstellen",
        page_description: "F√ºge Dateien hinzu, w√§hle Freunde aus und lege einen Schwellenwert fest. Jeder Freund erh√§lt einen Anteil, den er sp√§ter zur Wiederherstellung deiner Dateien verwenden kann. Alles l√§uft lokal ‚Äì deine Dateien verlassen deinen Browser niemals.",
        subtitle: "Wer einen Freund hat, hat einen Schatz.",

        step1_title: "Freunde",
        friends_hint: "F√ºge mindestens 2 Freunde hinzu, die Teile deines Wiederherstellungsschl√ºssels aufbewahren",
        anonymous_label: "Anonym",
        anonymous_hint: "Teilnehmer kennen einander nicht",
        num_shares_label: "Anzahl der Teile:",
        add_friend: "Freund hinzuf√ºgen",

        threshold_label: "Schwelle:",
        threshold_desc: "Freunde, die zur Wiederherstellung ben√∂tigt werden",

        name_label: "Name",
        email_label: "E-Mail",
        phone_label: "Telefon (optional)",

        import_summary: "Kontakte aus einer bestehenden project.yml importieren",
        import_placeholder: "F√ºge hier den Inhalt deiner project.yml ein...",
        import_btn: "Kontakte importieren",

        step2_title: "Zu sch√ºtzende Dateien",
        files_drop: "Ziehe einen Ordner hierher oder klicke, um Dateien auszuw√§hlen",
        files_hint: "Diese Dateien werden verschl√ºsselt und unter deinen Freunden verteilt",
        files_summary: "{0} Datei(en), {1} insgesamt",

        step3_title: "Umschl√§ge erstellen",
        generate_btn: "Umschl√§ge erstellen",
        download_all_btn: "Alle Umschl√§ge herunterladen",
        download_yaml_btn: "project.yml speichern",

        works_offline: "Funktioniert vollst√§ndig offline",
        need_help: "Brauchst du Hilfe?",
        download_cli: "CLI-Tool von GitHub herunterladen",

        generating: "Umschl√§ge werden erstellt...",
        archiving: "Dateien werden vorbereitet...",
        encrypting: "Dateien werden verschl√ºsselt...",
        splitting: "Schl√ºssel wird aufgeteilt...",
        creating_bundle: "Umschlag f√ºr {0} wird erstellt...",

        complete: "Alle Umschl√§ge wurden erfolgreich erstellt!",
        error: "Fehler: {0}",

        validation_min_friends: "Du brauchst mindestens 2 Freunde",
        validation_friend_name: "Freund {0}: Name ist erforderlich",
        validation_friend_email: "Freund {0} ({1}): E-Mail ist erforderlich",
        validation_no_files: "Bitte w√§hle mindestens eine Datei aus",

        download: "Herunterladen",
        bundle_for: "Umschlag f√ºr {0}",

        import_success: "{0} Kontakte importiert",
        import_error: "YAML konnte nicht verarbeitet werden: {0}",
        error_title: "Etwas ist schiefgelaufen",
        error_not_ready_title: "Noch nicht bereit",
        error_not_ready_message: "Der Umschlag-Ersteller wird noch geladen.",
        error_not_ready_guidance: "Bitte warte einen Moment und versuche es erneut.",
        error_import_title: "Import fehlgeschlagen",
        error_import_guidance: "Stelle sicher, dass das YAML-Format korrekt ist. √úberpr√ºfe die Einr√ºckung und ob alle erforderlichen Felder (Name, E-Mail) vorhanden sind.",
        error_min_friends_title: "Mindestanzahl an Freunden erforderlich",
        error_min_friends_guidance: "F√ºr die Wiederherstellung werden mindestens 2 Freunde ben√∂tigt, um das Geheimnis aufzuteilen. F√ºge weitere Freunde hinzu, um fortzufahren.",
        error_generate_title: "Umschlag-Erstellung fehlgeschlagen",
        error_generate_guidance: "√úberpr√ºfe, ob alle Freunde Namen und E-Mail haben und ob du mindestens eine Datei ausgew√§hlt hast. Versuche es dann erneut.",
        action_try_again: "Erneut versuchen",
        validation_title: "Einige Felder ben√∂tigen Aufmerksamkeit",
        validation_message: "Bitte f√ºlle die markierten Felder aus, bevor du Umschl√§ge erstellst.",
        validation_guidance: "Pflichtfelder sind mit einem Sternchen (*) gekennzeichnet. Stelle sicher, dass jeder Freund einen Namen und eine E-Mail hat und du mindestens eine Datei hinzugef√ºgt hast."
      },

      fr: {
        loading: "Pr√©paration des enveloppes...",
        title: "üß† ReMemory ‚Äî Gardez l'essentiel",
        page_title: "Cr√©er des enveloppes",
        page_description: "Ajoutez des fichiers, choisissez des amis et d√©finissez un seuil. Chaque ami re√ßoit une part qu‚Äôil pourra utiliser plus tard pour aider √† r√©cup√©rer vos fichiers. Tout fonctionne localement : vos fichiers ne quittent jamais votre navigateur.",
        subtitle: "Qui a un ami a un tr√©sor.",

        step1_title: "Amis",
        friends_hint: "Ajoutez au moins 2 amis qui garderont des parties de votre cl√© de r√©cup√©ration",
        anonymous_label: "Anonyme",
        anonymous_hint: "Les participants ne conna√Ætront pas les autres",
        num_shares_label: "Nombre de parts :",
        add_friend: "Ajouter un ami",

        threshold_label: "Seuil :",
        threshold_desc: "amis n√©cessaires pour r√©cup√©rer",

        name_label: "Nom",
        email_label: "E-mail",
        phone_label: "T√©l√©phone (optionnel)",

        import_summary: "Importer des contacts depuis un project.yml existant",
        import_placeholder: "Collez le contenu de votre project.yml ici...",
        import_btn: "Importer les contacts",

        step2_title: "Fichiers √† prot√©ger",
        files_drop: "D√©posez un dossier ici ou cliquez pour s√©lectionner des fichiers",
        files_hint: "Ces fichiers seront chiffr√©s et r√©partis entre vos amis",
        files_summary: "{0} fichier(s), {1} au total",

        step3_title: "Cr√©er les enveloppes",
        generate_btn: "Cr√©er les enveloppes",
        download_all_btn: "T√©l√©charger toutes les enveloppes",
        download_yaml_btn: "Enregistrer project.yml",

        works_offline: "Fonctionne enti√®rement hors ligne",
        need_help: "Besoin d'aide ?",
        download_cli: "T√©l√©charger l'outil CLI depuis GitHub",

        generating: "Cr√©ation des enveloppes...",
        archiving: "Pr√©paration des fichiers...",
        encrypting: "Chiffrement des fichiers...",
        splitting: "Division de la cl√©...",
        creating_bundle: "Cr√©ation de l‚Äôenveloppe pour {0}...",

        complete: "Toutes les enveloppes ont √©t√© cr√©√©es avec succ√®s !",
        error: "Erreur : {0}",

        validation_min_friends: "Vous avez besoin d'au moins 2 amis",
        validation_friend_name: "Ami {0} : le nom est requis",
        validation_friend_email: "Ami {0} ({1}) : l'e-mail est requis",
        validation_no_files: "Veuillez s√©lectionner au moins un fichier",

        download: "T√©l√©charger",
        bundle_for: "Enveloppe pour {0}",

        import_success: "{0} contacts import√©s",
        import_error: "Impossible d'analyser le YAML : {0}",
        error_title: "Une erreur s'est produite",
        error_not_ready_title: "Pas encore pr√™t",
        error_not_ready_message: "Le cr√©ateur d'enveloppes est encore en cours de chargement.",
        error_not_ready_guidance: "Veuillez patienter un moment et r√©essayer.",
        error_import_title: "√âchec de l'importation",
        error_import_guidance: "Assurez-vous que le format YAML est correct. V√©rifiez l'indentation et que tous les champs requis (nom, e-mail) sont pr√©sents.",
        error_min_friends_title: "Nombre minimum d'amis requis",
        error_min_friends_guidance: "La r√©cup√©ration n√©cessite au moins 2 amis pour diviser le secret. Ajoutez plus d'amis pour continuer.",
        error_generate_title: "√âchec de la cr√©ation des enveloppes",
        error_generate_guidance: "V√©rifiez que tous les amis ont un nom et un e-mail, et que vous avez s√©lectionn√© au moins un fichier. R√©essayez ensuite.",
        action_try_again: "R√©essayer",
        validation_title: "Certains champs n√©cessitent votre attention",
        validation_message: "Veuillez remplir les champs en surbrillance avant de cr√©er les enveloppes.",
        validation_guidance: "Les champs obligatoires sont marqu√©s d'un ast√©risque (*). Assurez-vous que chaque ami a un nom et un e-mail, et que vous avez ajout√© au moins un fichier."
      },
      sl: {
        loading: "Pripravljam ustvarjalca sve≈ænjev ...",
        title: "üß† ReMemory - Ustvarjanje sve≈ænjev",
        page_title: "Ustvari sve≈ænje",
        page_description: "Dodajte datoteke, izberite prijatelje, nastavite prag. Vsak prijatelj dobi svoj sve≈æenj, ki ga lahko uporabi za pomoƒç pri obnovitvi va≈°ih datotek pozneje. Vse deluje lokalno - va≈°e datoteke nikoli ne zapustijo va≈°ega brskalnika.",
        subtitle: "Poskrbite, da va≈°i pomembni podatki nikoli ne bodo izgubljeni.",
        step1_title: "Prijatelji",
        friends_hint: "Dodajte vsaj 2 prijatelja, ki bosta vsak imela del va≈°ega obnovitvenega kljuƒça",
        anonymous_label: "Anonimno",
        anonymous_hint: "Prijatelji se ne bodo poznali med seboj",
        num_shares_label: "≈†tevilo prijateljev:",
        add_friend: "Dodaj prijatelja",
        threshold_label: "Prag:",
        threshold_desc: "prijatelji potrebni za obnovitev",
        name_label: "Ime",
        email_label: "E-po≈°ta",
        phone_label: "Telefon (neobvezno)",
        import_summary: "Uvozi stike iz obstojeƒçega project.yml",
        import_placeholder: "Prilepite vsebino va≈°ega project.yml tukaj ...",
        import_btn: "Uvozi prijatelje",
        step2_title: "Datoteke za za≈°ƒçito",
        files_drop: "Povlecite in spustite mapo sem ali kliknite za izbiro datotek",
        files_hint: "Te datoteke bodo ≈°ifrirane in razdeljene med va≈°e prijatelje",
        files_summary: "{0} datoteka(e), {1} skupaj",
        step3_title: "Ustvari sve≈ænje",
        generate_btn: "Ustvari sve≈ænje",
        download_all_btn: "Prenesi vse sve≈ænje",
        download_yaml_btn: "Shrani project.yml",
        works_offline: "Deluje popolnoma brez povezave",
        need_help: "Potrebujete pomoƒç?",
        download_cli: "Prenesite CLI orodje iz GitHub",
        generating: "Ustvarjanje sve≈ænjev ...",
        archiving: "Arhiviranje datotek ...",
        encrypting: "≈†ifriranje arhiva ...",
        splitting: "Razdeljevanje skrivnosti ...",
        creating_bundle: "Ustvarjanje sve≈ænja za {0} ...",
        complete: "Vsi sve≈ænji so bili uspe≈°no ustvarjeni!",
        error: "Napaka: {0}",
        validation_min_friends: "Potrebujete vsaj 2 prijatelja",
        validation_friend_name: "Prijatelj {0}: ime je obvezno",
        validation_friend_email: "Prijatelj {0} ({1}): e-po≈°ta je obvezna",
        validation_no_files: "Izberite vsaj eno datoteko",
        download: "Prenesi",
        bundle_for: "Sve≈æenj za {0}",
        import_success: "Uvo≈æeni {0} stiki",
        import_error: "Neuspe≈°no razƒçlenjevanje YAML: {0}",
        // Error messages with guidance
        error_title: "Nekaj je ≈°lo narobe",
        error_not_ready_title: "Proces ≈°e ni konƒçan",
        error_not_ready_message: "Ustvarjalec sve≈ænjev ≈°e ni pripravljen.",
        error_not_ready_guidance: "Poƒçakajte trenutek in poskusite znova.",
        error_import_title: "Uvoz ni uspel",
        error_import_guidance: "Prepriƒçajte se, da je format YAML pravilen. Preverite pravilno zamik in da so vsa obvezna polja (ime, e-po≈°ta) prisotna.",
        error_min_friends_title: "Potrebno je dodati vsaj 2 prijatelja",
        error_min_friends_guidance: "Za obnovitev je potrebno vsaj dodati 2 prijatelja za razdelitev skrivnosti. Dodajte veƒç prijateljev, da nadaljujete.",
        error_generate_title: "Ustvarjanje sve≈ænja ni uspelo",
        error_generate_guidance: "Preverite, da imajo vsi prijatelji ime in e-po≈°to ter da ste izbrali vsaj eno datoteko. Nato poskusite znova.",
        action_try_again: "Poskusi znova",
        validation_title: "Nekatera polja je potrebno doplniti",
        validation_message: "Izpolnite oznaƒçena polja, preden ustvarite sve≈ænje.",
        validation_guidance: "Obvezna polja so oznaƒçena z zvezdico (*). Prepriƒçajte se, da ima vsak prijatelj ime in e-po≈°to ter da ste dodali vsaj eno datoteko."
      },
    };

    let currentLang = 'en';

    function t(key, ...args) {
      let text = translations[currentLang][key] || translations['en'][key] || key;
      args.forEach((arg, i) => {
        text = text.replace(`{${i}}`, arg);
      });
      return text;
    }

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('rememory-lang', lang);

      // Update toggle buttons
      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      // Update all translatable elements
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        el.textContent = t(key);
      });

      // Update placeholder attributes
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        el.placeholder = t(key);
      });

      // Update page title
      document.title = t('title');

      // Re-render dynamic content
      if (typeof window.rememoryUpdateUI === 'function') {
        window.rememoryUpdateUI();
      }
    }

    // Set initial language immediately
    (function() {
      const saved = localStorage.getItem('rememory-lang');
      const browserLang = navigator.language.split('-')[0];
      currentLang = saved || (['es', 'de', 'fr'].includes(browserLang) ? browserLang : 'en');
    })();

    // Initialize language toggle buttons after DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      setLanguage(currentLang);

      // Add click handlers
      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        btn.addEventListener('click', () => {
          setLanguage(btn.dataset.lang);
        });
      });
    });
  </script>

  <!-- Go WASM runtime -->
  <script>{{WASM_EXEC}}</script>

  <!-- Embedded WASM binary (base64) -->
  <script>
    window.WASM_BINARY = "{{WASM_BASE64}}";
    window.VERSION = "{{VERSION}}";
    window.GITHUB_URL = "{{GITHUB_URL}}";
  </script>

  <!-- Application logic -->
  <script>{{CREATE_APP_JS}}</script>

  <!-- Load WASM from embedded gzip-compressed binary -->
  <script>
    (async function() {
      const go = new Go();
      try {
        // Decode base64 to get gzip-compressed data
        const compressed = Uint8Array.from(atob(window.WASM_BINARY), c => c.charCodeAt(0));

        // Decompress using DecompressionStream (modern browsers)
        let bytes;
        if (typeof DecompressionStream !== 'undefined') {
          const ds = new DecompressionStream('gzip');
          const writer = ds.writable.getWriter();
          writer.write(compressed);
          writer.close();
          const reader = ds.readable.getReader();
          const chunks = [];
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            chunks.push(value);
          }
          const totalLength = chunks.reduce((acc, chunk) => acc + chunk.length, 0);
          bytes = new Uint8Array(totalLength);
          let offset = 0;
          for (const chunk of chunks) {
            bytes.set(chunk, offset);
            offset += chunk.length;
          }
        } else {
          // Fallback: use pako if available, or show error
          if (typeof pako !== 'undefined') {
            bytes = pako.inflate(compressed);
          } else {
            throw new Error('Browser does not support DecompressionStream');
          }
        }

        const result = await WebAssembly.instantiate(bytes.buffer, go.importObject);
        go.run(result.instance);
      } catch (err) {
        // Show user-friendly error with guidance
        document.getElementById('loading-overlay').innerHTML = `
          <div class="loading-error">
            <div class="loading-error-icon">‚ö†Ô∏è</div>
            <div class="loading-error-title">Failed to load bundle creator</div>
            <div class="loading-error-message">
              The bundle creation module couldn't be loaded in your browser.
              This can happen with older browsers or certain privacy settings.
            </div>
            <div class="loading-error-actions">
              <button class="btn btn-primary" onclick="window.location.reload()">Reload page</button>
              <a href="https://github.com/eljojo/rememory" class="btn btn-secondary" target="_blank">Use CLI tool instead</a>
            </div>
          </div>
        `;
      }
    })();
  </script>
</body>
</html>
